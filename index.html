<!DOCTYPE html>
<html lang="en">
	<head>
		<link rel="stylesheet" type="text/css" href="/reddit.css">
		<script type="text/javascript" src="/jquery.js"></script>
		<script type="text/javascript" src="/jQote2.js"></script>
		<script type="text/x-jqote-template" id="template">
			<![CDATA[
				<div class="link" data-ups=<%= this.up %>>
					<p class="parent"></p>
					<span class="rank">fb</span>
					<div class="entry">
						<a class="thumbnail" href=<%= this.link %>>
							<img src=<%= this.picture %>>
						</a>
						<p class="title">
							<a class="title" href=<%= this.link %>>
								<%= this.title %>
							</a>
							<span class="domain">
								(facebook)
							</span>
						</p>
						<p class="tagline">
							submitted <%= this.created %> hours ago by 
							<a href=<%= this.link %>>
								<%= this.author %>
							</a>
						</p>
					</div>
				</div>
				<div class="child"></div>
			]]>
		</script>
	</head>
	<body>
		<div id="fb-root"></div>
		<script>
			window.fbAsyncInit = function() {
				FB.init({
					appId	: '420413834760858',
					status	: true,
					xfbml	: true
				});
			};
			
			(function(d, s, id) {
				var js, fjs = d.getElementsByTagName(s)[0];
				if (d.getElementById(id)) {return;}
				js = d.createElement(s); js.id = id;
				js.src = "//connect.facebook.net/en_US/all.js";
				fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facbebook-jssdk'));

			function FbLogin(){
				FB.login(function(){
					FB.api(
						"/me/home",
						function (response) {
							if (response && !response.error){
								genFeed(response);
							}
						}
					);
				}, {
					scope: 'read_stream'
				});
			}

			var test;
			function genFeed(r){
				test = r;
				for (var i=0; i < r.data.length; i++){
					console.log(r.data[i]);
					current = r.data[i];
					$("#fb-feed").append(
						$("#template").jqote({
							up : (current.likes && current.likes.data.length)
							|| 0,
							title : current.story || current.message,
							created : Math.round((new Date().getTime() - new
							Date(current.created_time).getTime())/(3600000)*10)/10,
							author: current.from.name,
							link: current.link,
							picture: current.picture
						})
					);
				}
			}
		</script>
		<input id="fb-go" type="button" value="Facebook" onclick="FbLogin()">
		<div id="fb-feed">
		</div>
	</body>
</html>
